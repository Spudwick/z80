
# ======================================================
# $(call REG_MODULE,<Module>)
# ------------------------------------------------------
# Configures and setup environment ready to add module.
# ======================================================
define REG_MODULE 
$(call SET_MODDIR,$1,$(ROOT_DIR)$1)
endef
# ======================================================


# ======================================================
# $(call ADD_MODULE,<Module>)
# ------------------------------------------------------
# Configures and setup environment ready to add module.
# ======================================================
define ADD_MODULE 
$(call ADD_SRCDIR,$1,$(call GET_MODDIR,$1)/$(SRC_TREE))

$(foreach MF,$(wildcard $(ROOT_DIR)$1/*.mod),$(eval include $(MF)))
endef
# ======================================================


# ======================================================
# $(call SET_MODDIR,<Module>,<Path>)
# ------------------------------------------------------
# Sets the directory asociated with a module.
# ======================================================
define SET_MODDIR
MODDIR_$1 := $2
endef
# ======================================================


# ======================================================
# $(call GET_MODDIR,<Module>)
# ------------------------------------------------------
# Gets the directory asociated with a module.
# ======================================================
define GET_MODDIR
$(MODDIR_$1)
endef
# ======================================================


# ======================================================
# $(call ADD_SRCDIR,<Module>,<Path>)
# ------------------------------------------------------
# Adds a source directory to module.
# ======================================================
define ADD_SRCDIR
ADDED += $(call GET_MODDIR,$1)/$(SRC_TREE)*.c
$(foreach SRC,$(wildcard $(call GET_MODDIR,$1)/$(SRC_TREE)*.c),$(eval $(call ADD_CFILE,$1,$(SRC))))
$(foreach SRC,$(wildcard $(call GET_MODDIR,$1)/$(SRC_TREE)*.s),$(eval $(call ADD_SFILE,$1,$(SRC))))
endef
# ======================================================


# ======================================================
# $(call ADD_CFILE,<Module>,<Path>)
# ------------------------------------------------------
# 
# ======================================================
define ADD_CFILE
C_$1 += $2

$(call ADD_PFILE,$1,$(call GET_MODDIR,$1)/$(PP_TREE)$(notdir $2))
endef
# ======================================================


# ======================================================
# $(call ADD_PFILE,<Module>,<Path>)
# ------------------------------------------------------
# 
# ======================================================
define ADD_PFILE
PP_$1 += $2

$(call ADD_SFILE,$1,$(call GET_MODDIR,$1)/$(ASM_TREE)$(notdir $(subst $(suffix $2),.s,$2)))
endef
# ======================================================


# ======================================================
# $(call ADD_SFILE,<Module>,<Path>)
# ------------------------------------------------------
# 
# ======================================================
define ADD_SFILE
S_$1 += $2

$(call ADD_RFILE,$1,$(call GET_MODDIR,$1)/$(REL_TREE)$(notdir $(subst $(suffix $2),.rel,$2)))
endef
# ======================================================


# ======================================================
# $(call ADD_RFILE,<Module>,<Path>)
# ------------------------------------------------------
# 
# ======================================================
define ADD_RFILE
REL_$1 += $2
endef
# ======================================================
